schemaversion: 1

source:
  kafka:
    url: ip-kafka:9208
    username: null
    password: null
  mysql:
    connection_string: ..... 

destination:
  mysql:
    connection_string: .....

  initiate:
    ddl_to_destination: CREATE TABLE new_mantap # "ignore | drop | fail" handled by sql
    dml_from_source: 'SELECT count(1) as Quantity from transaction'
    if_data_exists: "ignore | drop | fail"


from_event:
  topic: 'trans'
  logic:
    on_insert:
      - if:
          - after.status != 99
        then:
            sql: UPDATE tabel_mantap SET Quantity = Quantity + 1
    on_update:
      - if:
          - before.status != 99
          - after.status == 99
        then:
          sql: UPDATE tabel_mantap SET Quantity = Quantity - 1
      - if:
          - before.status == 99
          - after.status != 99
        then:
          sql: UPDATE tabel_mantap SET Quantity = Quantity + 1
    on_delete:
      - if:
          - before.status != 99
        then:
          sql.$: UPDATE tabel_mantap SET Quantity = Quantity - 1; INSERT INTO tabel_lain values id={{before.id}}
